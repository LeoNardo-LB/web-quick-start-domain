<?xml version="1.0"?>
<!DOCTYPE module PUBLIC
        "-//Checkstyle//DTD Checkstyle Configuration 1.3//EN"
        "https://checkstyle.org/dtds/configuration_1_3.dtd">

<!--
    Checkstyle 配置文件
    基于 DDD 四层架构项目定制

    包含规则：
    - 注释规范：JavadocType、JavadocMethod、JavadocStyle
    - 日志规范：禁止字符串拼接、异常日志检查
    - 代码风格：LineLength、Indentation、ImportOrder
    - 命名规范：ConstantName、MemberName、MethodName、TypeName
-->
<module name="Checker">
    <property name="charset" value="UTF-8"/>
    <property name="severity" value="error"/>
    <property name="fileExtensions" value="java"/>

    <!-- 引用 suppressions 文件 -->
    <module name="SuppressionFilter">
        <property name="file" value="config/checkstyle/checkstyle-suppressions.xml"/>
        <property name="optional" value="true"/>
    </module>

    <!-- 禁止文件末尾换行符不一致（接受系统默认） -->
    <module name="NewlineAtEndOfFile"/>

    <!-- 禁止文件中出现 Tab 字符 -->
    <module name="FileTabCharacter">
        <property name="eachLine" value="true"/>
    </module>

    <!-- 行长度限制：120 字符 -->
    <module name="LineLength">
        <property name="max" value="120"/>
        <property name="ignorePattern" value="^package.*|^import.*|a href|href|http://|https://|ftp://"/>
    </module>

    <module name="TreeWalker">
        <!-- ==================== 注释规范 ==================== -->

        <!-- 类/接口/枚举必须有 Javadoc -->
        <module name="JavadocType">
            <property name="scope" value="public"/>
        </module>

        <!-- Javadoc 格式检查 -->
        <module name="JavadocStyle">
            <property name="checkFirstSentence" value="false"/>
            <property name="checkEmptyJavadoc" value="true"/>
            <property name="checkHtml" value="true"/>
        </module>

        <!-- Javadoc 内容检查 -->
        <module name="JavadocContentLocationCheck">
            <property name="location" value="second_line"/>
        </module>

        <!-- 缺失 Javadoc 检查：类 -->
        <module name="MissingJavadocType">
            <property name="scope" value="public"/>
        </module>

        <!-- 缺失 Javadoc 检查：方法 -->
        <module name="MissingJavadocMethod">
            <property name="scope" value="protected"/>
            <property name="allowMissingPropertyJavadoc" value="true"/>
            <property name="minLineCount" value="1"/>
        </module>

        <!-- ==================== @param 格式检查 ==================== -->

        <!-- @param 格式：参数名后必须有空格和描述 -->
        <module name="RegexpSinglelineJava">
            <property name="format" value="@param\s+\w+\s*$"/>
            <property name="message" value="@param 格式错误：参数名后需要描述"/>
            <property name="ignoreComments" value="false"/>
        </module>

        <!-- @return 格式：必须有描述 -->
        <module name="RegexpSinglelineJava">
            <property name="format" value="@return\s*$"/>
            <property name="message" value="@return 格式错误：需要描述"/>
            <property name="ignoreComments" value="false"/>
        </module>

        <!-- ==================== 日志规范 ==================== -->

        <!-- 禁止日志使用字符串拼接 -->
        <module name="RegexpSinglelineJava">
            <property name="format" value="log\.(info|debug|warn|error)\([^)]*\+[^)]*\)"/>
            <property name="message" value="日志禁止使用字符串拼接，请使用占位符 {}"/>
            <property name="ignoreComments" value="true"/>
        </module>

        <!-- 禁止异常日志仅传递消息（必须传递异常对象） -->
        <module name="RegexpSinglelineJava">
            <property name="format" value="log\.error\([^)]*\.getMessage\(\)[^)]*\)"/>
            <property name="message" value="异常日志必须传递异常对象，禁止仅传递 e.getMessage()"/>
            <property name="ignoreComments" value="true"/>
        </module>

        <!-- ==================== 代码风格 ==================== -->

        <!-- 缩进：4 空格 -->
        <module name="Indentation">
            <property name="basicOffset" value="4"/>
            <property name="braceAdjustment" value="0"/>
            <property name="caseIndent" value="4"/>
            <property name="throwsIndent" value="8"/>
            <property name="lineWrappingIndentation" value="8"/>
            <property name="arrayInitIndent" value="4"/>
        </module>

        <!-- 导入顺序（已禁用，保持原有导入顺序） -->
        <!--
        <module name="ImportOrder">
            <property name="groups" value="java,jakarta,org,com,org.smm.archetype"/>
            <property name="ordered" value="true"/>
            <property name="separated" value="true"/>
            <property name="separatedStaticGroups" value="true"/>
            <property name="sortStaticImportsAlphabetically" value="true"/>
            <property name="option" value="top"/>
        </module>
        -->

        <!-- 禁止使用通配符导入 -->
        <module name="AvoidStarImport">
            <property name="excludes" value="org.junit.Assert,org.mockito.Mockito"/>
        </module>

        <!-- 禁止重复导入 -->
        <module name="RedundantImport"/>

        <!-- 禁止无用导入 -->
        <module name="UnusedImports"/>

        <!-- ==================== 命名规范 ==================== -->

        <!-- 常量命名：大写下划线 -->
        <module name="ConstantName">
            <property name="format" value="^[A-Z][A-Z0-9]*(_[A-Z0-9]+)*$|^[a-z][a-zA-Z0-9]*$"/>
        </module>

        <!-- 局部变量命名：驼峰 -->
        <module name="LocalVariableName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
        </module>

        <!-- 成员变量命名：驼峰 -->
        <module name="MemberName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
        </module>

        <!-- 方法命名：驼峰 -->
        <module name="MethodName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
        </module>

        <!-- 参数命名：驼峰 -->
        <module name="ParameterName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
        </module>

        <!-- 类/接口/枚举命名：帕斯卡 -->
        <module name="TypeName">
            <property name="format" value="^[A-Z][a-zA-Z0-9]*$"/>
        </module>

        <!-- Lambda 参数命名：驼峰 -->
        <module name="LambdaParameterName">
            <property name="format" value="^[a-z][a-zA-Z0-9]*$"/>
        </module>

        <!-- 包命名：全小写 -->
        <module name="PackageName">
            <property name="format" value="^[a-z]+(\.[a-z][a-z0-9]*)*$"/>
        </module>

        <!-- ==================== 其他规则 ==================== -->

        <!-- 禁止空代码块 -->
        <module name="EmptyBlock">
            <property name="option" value="text"/>
            <property name="tokens"
                      value="LITERAL_WHILE,LITERAL_TRY,LITERAL_CATCH,LITERAL_FINALLY,LITERAL_DO,LITERAL_IF,LITERAL_ELSE,LITERAL_FOR,INSTANCE_INIT,STATIC_INIT,LITERAL_SWITCH,LITERAL_SYNCHRONIZED,LITERAL_CASE,LITERAL_DEFAULT"/>
        </module>

        <!-- 左大括号位置 -->
        <module name="LeftCurly">
            <property name="option" value="eol"/>
        </module>

        <!-- 右大括号位置 -->
        <module name="RightCurly">
            <property name="option" value="same"/>
        </module>

        <!-- 禁止空语句 -->
        <module name="EmptyStatement"/>

        <!-- 禁止多余修饰符 -->
        <module name="ModifierOrder"/>

        <!-- 禁止嵌套代码块 -->
        <module name="AvoidNestedBlocks"/>

        <!-- 每行只能有一个语句 -->
        <module name="OneStatementPerLine"/>

        <!-- 默认 case 必须在最后 -->
        <module name="DefaultComesLast"/>

        <!-- 禁止空 catch 块 -->
        <module name="EmptyCatchBlock">
            <property name="exceptionVariableName" value="expected|ignore"/>
        </module>

        <!-- 禁止多个变量声明在同一行 -->
        <module name="MultipleVariableDeclarations"/>

        <!-- 数组类型风格 -->
        <module name="ArrayTypeStyle">
            <property name="javaStyle" value="true"/>
        </module>

        <!-- 方法复杂度 -->
        <module name="CyclomaticComplexity">
            <property name="max" value="15"/>
        </module>

        <!-- 方法长度 -->
        <module name="MethodLength">
            <property name="max" value="150"/>
            <property name="countEmpty" value="false"/>
        </module>

        <!-- 参数个数 -->
        <module name="ParameterNumber">
            <property name="max" value="10"/>
            <property name="ignoreOverriddenMethods" value="true"/>
        </module>

    </module>
</module>
